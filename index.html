<!-- ... HEAD และ BODY ตอนต้นเหมือนเดิม ... -->

<script>
  window.onload = () => {
    const unlockBtn   = document.getElementById('unlock');
    const scanFrame   = document.querySelector('.scan-frame');
    const status      = document.getElementById('status');
    const arScene     = document.getElementById('ar-scene');
    const marker      = document.getElementById('hiro-marker');
    const modelOrigin = document.getElementById('model-entity');
    const videoOrigin = document.getElementById('video-entity');
    const cameraWrap  = document.getElementById('camera-wrapper');
    const voice       = document.getElementById('voice');
    const sideVideo   = document.getElementById('side-video');
    let anchored      = false;

    const startAR = () => {
      voice.play().then(()=>voice.pause());
      sideVideo.play().then(()=>sideVideo.pause());
      unlockBtn.style.display = 'none';
      scanFrame.style.display = 'block';
      status.style.display    = 'block';
      arScene.style.visibility = 'visible';
      document.body.removeEventListener('click', startAR);
    };
    document.body.addEventListener('click', startAR);

    marker.addEventListener('markerFound', () => {
      status.textContent = 'พบ Hiro Marker!';
      status.style.background = 'rgba(0,255,0,0.7)';
      scanFrame.style.display = 'none';

      const mixer = modelOrigin.components['animation-mixer'];
      if(mixer){ mixer.mixer.setTime(0); mixer.play(); }

      if(!anchored){
        // ซ่อนต้นฉบับ
        modelOrigin.setAttribute('visible','false');
        videoOrigin.setAttribute('visible','false');

        // ---- วิดีโอ (ด้านหลัง) ----
        const cloneVideo = videoOrigin.cloneNode(true);
        cloneVideo.removeAttribute('id');
        cloneVideo.setAttribute('visible','true');
        cloneVideo.setAttribute('rotation','0 0 0');
        cloneVideo.setAttribute('position','0 0 -2');  // ✅ ถอยห่างกล้อง
        cloneVideo.setAttribute('width','1.5');
        cloneVideo.setAttribute('height','2.67');

        // ---- โมเดล (หน้า/ขวา) ----
        const cloneModel = modelOrigin.cloneNode(true);
        cloneModel.removeAttribute('id');
        cloneModel.setAttribute('visible','true');
        cloneModel.setAttribute('rotation','0 180 0');
        cloneModel.setAttribute('position','0.5 -0.5 -1.6');  // ✅ ห่างวิดีโอแต่ยังอยู่หน้า
        cloneModel.setAttribute('scale','0.4 0.4 0.4');       // ✅ เล็กลงเพื่อมองเห็นชัดเจน

        // เพิ่มเข้ากล้อง
        cameraWrap.appendChild(cloneVideo);
        cameraWrap.appendChild(cloneModel);

        // เมื่อแสดงแล้ว: ค่อยเล่นวิดีโอและเสียงจริง
        setTimeout(() => {
          voice.currentTime = 0; voice.play().catch(()=>{});
          sideVideo.currentTime = 0; sideVideo.play().catch(()=>{});
        }, 300);  // หน่วงเล็กน้อยเพื่อให้แน่ใจว่ามีการแสดงแล้ว

        anchored = true;
      }
    });

    marker.addEventListener('markerLost', () => {
      status.textContent = 'กำลังค้นหา Hiro Marker...';
      status.style.background = 'rgba(0,0,0,0.7)';
    });
  };
</script>
