<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR Hiro Marker Scanner</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/dev/aframe/build/aframe-ar.js"></script>
  <style>
    body {
      margin: 0; 
      overflow: hidden; 
      background: #000; 
      color: #fff; 
      font-family: Arial, sans-serif;
    }

    #unlockBtn {
      position: fixed; 
      top: 50%; 
      left: 50%; 
      transform: translate(-50%, -50%); 
      background: rgba(0,150,255,0.9); 
      color: white; 
      border: none; 
      padding: 20px 40px; 
      font-size: 18px; 
      border-radius: 10px; 
      cursor: pointer; 
      z-index: 1000;
    }

    #scanFrame {
      position: fixed; 
      top: 20px; 
      left: 20px; 
      right: 20px; 
      bottom: 20px; 
      background: transparent; 
      border: none;
      z-index: 100; 
      pointer-events: none; 
      display: none;
    }

    #status {
      position: fixed; 
      top: 20px; 
      left: 20px; 
      background: rgba(0,0,0,0.7); 
      color: white; 
      padding: 10px 20px; 
      border-radius: 5px; 
      font-size: 14px; 
      z-index: 200; 
      display: none;
    }

    #careerBtn {
      position: fixed; 
      bottom: 30px; 
      right: 30px; 
      background: rgba(255,150,0,0.9); 
      color: white; 
      border: none; 
      padding: 15px 25px; 
      font-size: 16px; 
      border-radius: 8px; 
      cursor: pointer; 
      z-index: 200; 
      display: none;
    }

    #careerMenu {
      position: fixed; 
      top: 50%; 
      left: 50%; 
      transform: translate(-50%, -50%); 
      background: rgba(0,0,0,0.9); 
      padding: 30px; 
      border-radius: 15px; 
      text-align: center; 
      z-index: 300; 
      display: none;
    }

    #careerMenu h3 {
      margin-top: 0; 
      color: #00AAFF; 
      font-size: 20px;
    }

    #careerMenu button {
      display: block; 
      width: 200px; 
      margin: 10px auto; 
      padding: 12px; 
      background: rgba(0,150,255,0.8); 
      color: white; 
      border: none; 
      border-radius: 8px; 
      font-size: 16px; 
      cursor: pointer;
    }

    #careerMenu button:hover {
      background: rgba(0,180,255,1);
    }

    #closeMenu {
      background: rgba(255,50,50,0.8) !important;
    }

    #closeMenu:hover {
      background: rgba(255,80,80,1) !important;
    }

    #arScene {
      visibility: hidden;
    }
  </style>
</head>
<body>
  <button id="unlockBtn">üéØ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô AR</button>
  <div id="scanFrame"></div>
  <div id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°...</div>
  <button id="careerBtn">üè¢ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</button>

  <div id="careerMenu">
    <h3>üè¢ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
    <button data-career="Test Model">üß™ Test Model</button>
    <button data-career="Network Engineer">üåê Network Engineer</button>
    <button data-career="Cloud Engineer">‚òÅÔ∏è Cloud Engineer</button>
    <button data-career="AI Engineer">ü§ñ AI Engineer</button>
    <button data-career="Data Center">üè¢ Data Center</button>
    <button id="closeMenu">‚ùå ‡∏õ‡∏¥‡∏î</button>
  </div>

  <a-scene id="arScene" embedded arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
    
    <a-assets>
      <!-- ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏´‡∏•‡∏±‡∏Å -->
      <a-asset-item id="main-model" src="model.glb"></a-asset-item>
      <!-- ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏´‡∏•‡∏±‡∏Å -->
      <video id="side-video" src="career-video.mp4" preload="auto" crossorigin="anonymous" playsinline muted loop></video>
      <!-- ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏•‡∏±‡∏Å -->
      <audio id="voice" src="voice.mp3" preload="auto"></audio>
    </a-assets>

    <!-- Hiro Marker -->
    <a-marker id="hiro-marker" preset="hiro">
      
      <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏à‡∏≤‡∏Å marker -->
      <a-entity id="marker-container">
        <!-- ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏à‡∏≤‡∏Å marker (‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á ‡πÄ‡∏Å‡πà‡∏≤) -->
        <a-entity id="main-model-entity" 
                  gltf-model="#main-model" 
                  animation-mixer
                  scale="0.3 0.3 0.3" 
                  position="0 0 0" 
                  rotation="0 45 0">
        </a-entity>

        <!-- ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏≤‡∏Å marker (‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≤‡∏á ‡πÄ‡∏Å‡πà‡∏≤) -->
        <a-plane id="side-video-plane" 
                 material="src: #side-video; side: double; transparent: false; shader: flat" 
                 width="1.5" 
                 height="0.84" 
                 position="-2 0.5 0" 
                 rotation="0 15 0">
        </a-plane>
      </a-entity>

      <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏≠‡∏≤‡∏ä‡∏µ‡∏û (‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏î‡∏¢‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô) -->
      <a-entity id="career-container" visible="false">
        <!-- ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏≠‡∏≤‡∏ä‡∏µ‡∏û (‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤) -->
        <a-entity id="career-model" 
                  scale="0.3 0.3 0.3" 
                  position="-0.3 0.08 0.1" 
                  rotation="0 45 0"
                  visible="false">
        </a-entity>

        <!-- ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û (‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á) -->
        <a-plane id="career-video" 
                 width="1.5" 
                 height="0.84" 
                 position="0.4 0.5 -0.1" 
                 rotation="0 0 0"
                 visible="false">
        </a-plane>

        <!-- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
        <a-text id="career-status" 
                value="Career Loading..." 
                position="0 1.2 0" 
                align="center" 
                color="yellow" 
                visible="false">
        </a-text>
      </a-entity>

    </a-marker>

    <!-- ‡∏Å‡∏•‡πâ‡∏≠‡∏á -->
    <a-entity camera></a-entity>
    
  </a-scene>

  <script>
    console.log('üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô AR Application...');
    
    const arScene = document.querySelector('#arScene');
    const marker = document.querySelector('#hiro-marker');
    const markerContainer = document.querySelector('#marker-container');
    const careerContainer = document.querySelector('#career-container');
    
    const mainModel = document.querySelector('#main-model-entity');
    const sideVideo = document.querySelector('#side-video');
    const voice = document.querySelector('#voice');
    
    const careerModel = document.querySelector('#career-model');
    const careerVideo = document.querySelector('#career-video');
    const careerStatus = document.querySelector('#career-status');
    
    const unlockBtn = document.querySelector('#unlockBtn');
    const scanFrame = document.querySelector('#scanFrame');
    const status = document.querySelector('#status');
    const careerBtn = document.querySelector('#careerBtn');
    const menu = document.querySelector('#careerMenu');
    const closeBtn = document.querySelector('#closeMenu');
    
    let markerFound = false;

    // ‡∏£‡∏≠‡πÉ‡∏´‡πâ A-Frame ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
    arScene.addEventListener('loaded', () => {
      console.log('‚úÖ A-Frame ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à');
      
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î asset ‡πÅ‡∏ö‡∏ö‡πÑ‡∏î‡∏ô‡∏≤‡∏°‡∏¥‡∏Å (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô cache)
      const loadAssetDynamic = (id, src) => {
        return new Promise((resolve) => {
          // ‡∏•‡∏ö asset ‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
          const existingAssets = document.querySelectorAll(`[id^="${id}"]`);
          existingAssets.forEach(asset => {
            asset.remove();
            console.log('‡∏•‡∏ö asset ‡πÄ‡∏Å‡πà‡∏≤:', asset.id);
          });
          
          // ‡∏™‡∏£‡πâ‡∏≤‡∏á unique ID ‡∏î‡πâ‡∏ß‡∏¢ timestamp
          const timestamp = Date.now();
          const uniqueId = `${id}_${timestamp}`;
          
          const assets = document.querySelector('a-assets');
          
          if (src.endsWith('.mp4')) {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á video element ‡πÉ‡∏´‡∏°‡πà
            const videoEl = document.createElement('video');
            videoEl.id = uniqueId;
            videoEl.src = `${src}?t=${timestamp}`; // ‡πÄ‡∏û‡∏¥‡πà‡∏° timestamp ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô cache
            videoEl.setAttribute('preload', 'auto');
            videoEl.setAttribute('crossorigin', 'anonymous');
            videoEl.setAttribute('playsinline', '');
            videoEl.setAttribute('muted', '');
            videoEl.setAttribute('loop', '');
            
            console.log('‡∏™‡∏£‡πâ‡∏≤‡∏á video asset:', uniqueId, videoEl.src);
            assets.appendChild(videoEl);
            
            // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            const handleLoaded = () => {
              console.log('Video asset ‡∏û‡∏£‡πâ‡∏≠‡∏°:', uniqueId);
              resolve(`#${uniqueId}`);
            };
            
            if (videoEl.readyState >= 2) {
              handleLoaded();
            } else {
              videoEl.addEventListener('loadeddata', handleLoaded, { once: true });
              // Backup timeout
              setTimeout(() => {
                console.log('Video timeout - ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠:', uniqueId);
                resolve(`#${uniqueId}`);
              }, 3000);
            }
            
          } else {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á asset item ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏°‡πÄ‡∏î‡∏•
            const assetEl = document.createElement('a-asset-item');
            assetEl.id = uniqueId;
            assetEl.src = `${src}?t=${timestamp}`;
            
            console.log('‡∏™‡∏£‡πâ‡∏≤‡∏á model asset:', uniqueId, assetEl.src);
            assets.appendChild(assetEl);
            
            // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÇ‡∏´‡∏•‡∏î
            assetEl.addEventListener('loaded', () => {
              console.log('Model asset ‡∏û‡∏£‡πâ‡∏≠‡∏°:', uniqueId);
              resolve(`#${uniqueId}`);
            });
            
            // Backup timeout
            setTimeout(() => {
              console.log('Model timeout - ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠:', uniqueId);
              resolve(`#${uniqueId}`);
            }, 3000);
          }
        });
      };

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏≠‡πÉ‡∏´‡πâ Entity ‡∏û‡∏£‡πâ‡∏≠‡∏°
      const waitForEntity = (entity) => {
        return new Promise((resolve) => {
          if (entity.hasLoaded) {
            resolve();
          } else {
            entity.addEventListener('loaded', resolve, { once: true });
            setTimeout(resolve, 1000); // backup timeout
          }
        });
      };

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û
      const changeCareer = async (careerName) => {
        console.log('üîÑ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡πÄ‡∏õ‡πá‡∏ô:', careerName);
        
        // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô
        markerContainer.setAttribute('visible', 'false');
        careerContainer.setAttribute('visible', 'false');
        careerModel.setAttribute('visible', 'false');
        careerVideo.setAttribute('visible', 'false');
        careerStatus.setAttribute('visible', 'false');
        
        // ‡∏´‡∏¢‡∏∏‡∏î‡∏™‡∏∑‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        sideVideo.pause();
        voice.pause();
        
        // ‡∏´‡∏¢‡∏∏‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        const videoAssets = document.querySelectorAll('[id^="career-video-asset"]');
        videoAssets.forEach(video => {
          video.pause();
        });
        
        setTimeout(async () => {
          // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
          if (careerName === 'Test Model') {
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Test Model ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á marker content
            markerContainer.setAttribute('visible', 'true');
            careerContainer.setAttribute('visible', 'false');
            
            status.textContent = '‡πÅ‡∏™‡∏î‡∏á: ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô';
            status.style.background = 'rgba(0,255,0,0.7)';
            scanFrame.style.display = 'none';
            
            // ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å
            sideVideo.currentTime = 0;
            sideVideo.play().catch(e => console.warn('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÑ‡∏î‡πâ:', e));
            
            setTimeout(() => {
              voice.currentTime = 0;
              voice.play().catch(e => console.warn('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ:', e));
            }, 1000);
            
            return;
          }
          
          // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏≠‡∏∑‡πà‡∏ô ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û
          let modelSrc, videoSrc, audioSrc;
          
          switch (careerName) {
            case 'Network Engineer':
              modelSrc = 'network-model.glb';
              videoSrc = 'video-network.mp4';
              audioSrc = 'voice-network.mp3';
              break;
            case 'Cloud Engineer':
              modelSrc = 'cloud-model.glb';
              videoSrc = 'video-cloud.mp4';
              audioSrc = 'voice-cloud.mp3';
              break;
            case 'AI Engineer':
              modelSrc = 'ai-model.glb';
              videoSrc = 'video-ai.mp4';
              audioSrc = 'voice-ai.mp3';
              break;
            case 'Data Center':
              modelSrc = 'dc-model.glb';
              videoSrc = 'video-dc.mp4';
              audioSrc = 'voice-dc.mp3';
              break;
            default:
              modelSrc = 'model.glb';
              videoSrc = 'career-video.mp4';
              audioSrc = 'voice.mp3';
          }
          
          console.log('‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà:', { modelSrc, videoSrc, audioSrc });
          
          try {
            // ‡πÇ‡∏´‡∏•‡∏î assets ‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à
            console.log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î assets...');
            const modelRef = await loadAssetDynamic('career-model-asset', modelSrc);
            const videoRef = await loadAssetDynamic('career-video-asset', videoSrc);
            
            console.log('‡πÇ‡∏´‡∏•‡∏î assets ‡πÄ‡∏™‡∏£‡πá‡∏à:', { modelRef, videoRef });
            
            // ‡πÅ‡∏™‡∏î‡∏á career container
            careerContainer.setAttribute('visible', 'true');
            markerContainer.setAttribute('visible', 'false');
            
            // ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÉ‡∏´‡πâ A-Frame ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
            setTimeout(async () => {
              // ‡∏£‡∏≠‡πÉ‡∏´‡πâ entities ‡∏û‡∏£‡πâ‡∏≠‡∏°
              await waitForEntity(careerModel);
              await waitForEntity(careerVideo);
              
              // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÉ‡∏´‡∏°‡πà (‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤)
              console.log('‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏°‡πÄ‡∏î‡∏•...', modelRef);
              careerModel.setAttribute('gltf-model', modelRef);
              careerModel.setAttribute('animation-mixer', '');
              careerModel.setAttribute('visible', 'true');
              
              // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏ä‡∏µ‡∏û (‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏≠‡∏±‡∏ô‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô Cloud)
              let modelScale;
              if (careerName === 'Cloud Engineer') {
                modelScale = '0.2 0.2 0.2'; // ‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Cloud
                console.log('‡πÉ‡∏ä‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Cloud Engineer');
              } else {
                modelScale = '0.3 0.3 0.3'; // ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏≠‡∏∑‡πà‡∏ô
                console.log('‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö:', careerName);
              }
              
              careerModel.setAttribute('scale', modelScale); 
              careerModel.setAttribute('position', '-0.3 0.08 0.1'); // ‡∏ã‡πâ‡∏≤‡∏¢ ‡πÄ‡∏ó‡πâ‡∏≤‡∏ä‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤
              careerModel.setAttribute('rotation', '0 45 0'); // ‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏°‡∏∏‡∏°
              
              // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÉ‡∏´‡∏°‡πà (‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á)
              console.log('‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠...', videoRef);
              
              // ‡∏•‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÄ‡∏Å‡πà‡∏≤
              careerVideo.removeAttribute('material');
              careerVideo.removeAttribute('src');
              careerVideo.removeAttribute('text');
              
              // ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÉ‡∏´‡πâ A-Frame ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏ö
              setTimeout(() => {
                // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                careerVideo.setAttribute('material', `src: ${videoRef}; side: double; transparent: false; shader: flat`);
                careerVideo.setAttribute('visible', 'true');
                careerVideo.setAttribute('width', '1.5'); // ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
                careerVideo.setAttribute('height', '0.84'); 
                careerVideo.setAttribute('position', '0.4 0.5 -0.1'); // ‡∏Ç‡∏ß‡∏≤ ‡∏Ç‡∏∂‡πâ‡∏ô ‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á
                careerVideo.setAttribute('rotation', '0 0 0');
                
                // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ A-Frame ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï
                careerVideo.flushToDOM();
                console.log('‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à');
                
                // ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà
                setTimeout(() => {
                  // ‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á)
                  const videoElements = document.querySelectorAll('[id^="career-video-asset"]');
                  const videoElement = videoElements[videoElements.length - 1]; // ‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                  
                  if (videoElement) {
                    console.log('=== ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î ===');
                    console.log('Career Name:', careerName);
                    console.log('Video File:', videoSrc);
                    console.log('Video Element src:', videoElement.src);
                    console.log('Video ID:', videoElement.id);
                    
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
                    videoElement.pause();
                    videoElement.currentTime = 0;
                    videoElement.muted = true; 
                    videoElement.loop = true;
                    
                    // Force load the new video
                    videoElement.load();
                    
                    // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
                    const playVideo = () => {
                      videoElement.play().then(() => {
                        console.log('‚úÖ ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', careerName, '- ‡πÑ‡∏ü‡∏•‡πå:', videoSrc);
                        
                        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï A-Frame material ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        careerVideo.setAttribute('material', `src: ${videoRef}; side: double; transparent: false; shader: flat`);
                        
                        // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ A-Frame ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
                        if (careerVideo.components.material) {
                          careerVideo.components.material.material.needsUpdate = true;
                          if (careerVideo.components.material.material.map) {
                            careerVideo.components.material.material.map.needsUpdate = true;
                          }
                        }
                        
                      }).catch(e => {
                        console.warn('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÑ‡∏î‡πâ:', e);
                        // ‡πÅ‡∏™‡∏î‡∏á placeholder ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û
                        careerVideo.setAttribute('material', `color: #FF4444; transparent: false`);
                        careerVideo.setAttribute('text', `value: ${careerName}\nVIDEO ERROR; color: white; align: center; width: 8`);
                      });
                    };
                    
                    // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°
                    if (videoElement.readyState >= 2) {
                      playVideo();
                    } else {
                      videoElement.addEventListener('loadeddata', playVideo, { once: true });
                      // Timeout backup
                      setTimeout(playVideo, 2000);
                    }
                    
                  } else {
                    console.error('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö video element ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö:', careerName);
                    // ‡πÅ‡∏™‡∏î‡∏á placeholder ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û
                    careerVideo.setAttribute('material', `color: #44FF44; transparent: false`);
                    careerVideo.setAttribute('text', `value: ${careerName}\nNO VIDEO FOUND; color: black; align: center; width: 8`);
                  }
                  
                  // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á
                  voice.src = audioSrc;
                  voice.currentTime = 0;
                  voice.play().catch(e => console.warn('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ:', e));
                  console.log(`üéµ ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á: ${audioSrc}`);
                  
                  // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
                  status.textContent = `‡πÅ‡∏™‡∏î‡∏á: ${careerName} ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß`;
                  status.style.background = 'rgba(0,255,0,0.7)';
                  careerStatus.setAttribute('value', `${careerName} Ready!`);
                  careerStatus.setAttribute('visible', 'true');
                }, 1000);
                
              }, 100);
              
            }, 500);
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            status.textContent = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î: ${careerName}...`;
            status.style.background = 'rgba(255,255,0,0.7)';
            status.style.display = 'block';
            scanFrame.style.display = 'none';
            
          } catch (error) {
            console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î:', error);
            status.textContent = `‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${careerName}`;
            status.style.background = 'rgba(255,0,0,0.7)';
          }
          
        }, 300);
      };

      // ‡πÄ‡∏õ‡∏¥‡∏î AR ‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å
      const startAR = () => {
        voice.play().then(() => voice.pause()); 
        sideVideo.play().then(() => sideVideo.pause());
        unlockBtn.style.display = 'none'; 
        scanFrame.style.display = 'block'; 
        status.style.display = 'block'; 
        arScene.style.visibility = 'visible';
        careerBtn.style.display = 'block';
        document.body.removeEventListener('click', startAR);
      };
      document.body.addEventListener('click', startAR);

      // ‡∏û‡∏ö marker
      marker.addEventListener('markerFound', () => {
        status.textContent = '‡∏û‡∏ö Hiro Marker!';
        status.style.background = 'rgba(0,255,0,0.7)';
        scanFrame.style.display = 'none';
        markerFound = true;
        
        // ‡∏ã‡πà‡∏≠‡∏ô career container ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á marker container
        careerContainer.setAttribute('visible', 'false');
        markerContainer.setAttribute('visible', 'true');
        
        // ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å marker
        sideVideo.currentTime = 0; 
        sideVideo.play().catch(e=>console.warn(e)); 
        setTimeout(()=>{ 
          voice.currentTime=0; 
          voice.play().catch(e=>console.warn(e)); 
        },1000);
      });

      // ‡∏´‡∏≤‡∏¢ marker - ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ï‡∏•‡∏≠‡∏î (sticky display)
      marker.addEventListener('markerLost', () => {
        // ‡πÑ‡∏°‡πà‡∏ã‡πà‡∏≠‡∏ô marker container ‡πÅ‡∏°‡πâ marker ‡∏´‡∏≤‡∏¢‡πÑ‡∏õ
        // markerContainer ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà
        
        if (!markerFound) {
          status.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Hiro Marker...';
          status.style.background = 'rgba(0,0,0,0.7)';
          scanFrame.style.display = 'block';
        } else {
          status.textContent = '‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πÅ‡∏Å‡∏ô marker)';
          status.style.background = 'rgba(0,150,255,0.7)';
          scanFrame.style.display = 'none';
          // ‡πÉ‡∏´‡πâ marker container ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà
          markerContainer.setAttribute('visible', 'true');
        }
      });

      // ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏Ñ‡∏•‡∏¥‡∏Å
      careerBtn.addEventListener('click', () => {
        menu.style.display = 'block';
      });
      
      // ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π
      closeBtn.addEventListener('click', () => {
        menu.style.display = 'none';
      });
      
      // ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏¢‡∏á‡∏≤‡∏ô - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏• ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      menu.querySelectorAll('button[data-career]').forEach(btn => {
        btn.addEventListener('click', () => {
          const careerName = btn.getAttribute('data-career');
          changeCareer(careerName);
          menu.style.display = 'none';
        });
      });
    });
  </script>
</body>
</html>
