<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR Hiro Marker Scanner</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/dev/aframe/build/aframe-ar.js"></script>
  <style>
    body {
      margin: 0; 
      overflow: hidden; 
      background: #000; 
      color: #fff; 
      font-family: Arial, sans-serif;
    }

    #unlockBtn {
      position: fixed; 
      top: 50%; 
      left: 50%; 
      transform: translate(-50%, -50%); 
      background: rgba(0,150,255,0.9); 
      color: white; 
      border: none; 
      padding: 20px 40px; 
      font-size: 18px; 
      border-radius: 10px; 
      cursor: pointer; 
      z-index: 1000;
    }

    #scanFrame {
      position: fixed; 
      top: 20px; 
      left: 20px; 
      right: 20px; 
      bottom: 20px; 
      background: transparent; 
      border: none;
      z-index: 100; 
      pointer-events: none; 
      display: none;
    }

    #status {
      position: fixed; 
      top: 20px; 
      left: 20px; 
      background: rgba(0,0,0,0.7); 
      color: white; 
      padding: 10px 20px; 
      border-radius: 5px; 
      font-size: 14px; 
      z-index: 200; 
      display: none;
    }

    #careerBtn {
      position: fixed; 
      bottom: 30px; 
      right: 30px; 
      background: rgba(255,150,0,0.9); 
      color: white; 
      border: none; 
      padding: 15px 25px; 
      font-size: 16px; 
      border-radius: 8px; 
      cursor: pointer; 
      z-index: 200; 
      display: none;
    }

    #careerMenu {
      position: fixed; 
      top: 50%; 
      left: 50%; 
      transform: translate(-50%, -50%); 
      background: rgba(0,0,0,0.9); 
      padding: 30px; 
      border-radius: 15px; 
      text-align: center; 
      z-index: 300; 
      display: none;
    }

    #careerMenu h3 {
      margin-top: 0; 
      color: #00AAFF; 
      font-size: 20px;
    }

    #careerMenu button {
      display: block; 
      width: 200px; 
      margin: 10px auto; 
      padding: 12px; 
      background: rgba(0,150,255,0.8); 
      color: white; 
      border: none; 
      border-radius: 8px; 
      font-size: 16px; 
      cursor: pointer;
    }

    #careerMenu button:hover {
      background: rgba(0,180,255,1);
    }

    #closeMenu {
      background: rgba(255,50,50,0.8) !important;
    }

    #closeMenu:hover {
      background: rgba(255,80,80,1) !important;
    }

    #arScene {
      visibility: hidden;
    }
  </style>
</head>
<body>
  <button id="unlockBtn">üéØ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô AR</button>
  <div id="scanFrame"></div>
  <div id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°...</div>
  <button id="careerBtn">üè¢ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</button>

  <div id="careerMenu">
    <h3>üè¢ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
    <button data-career="Test Model">üß™ Test Model</button>
    <button data-career="Network Engineer">üåê Network Engineer</button>
    <button data-career="Cloud Engineer">‚òÅÔ∏è Cloud Engineer</button>
    <button data-career="AI Engineer">ü§ñ AI Engineer</button>
    <button data-career="Data Center">üè¢ Data Center</button>
    <button id="closeMenu">‚ùå ‡∏õ‡∏¥‡∏î</button>
  </div>

  <a-scene id="arScene" embedded arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
    
    <a-assets>
      <!-- ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏´‡∏•‡∏±‡∏Å -->
      <a-asset-item id="main-model" src="model.glb"></a-asset-item>
      <!-- ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏´‡∏•‡∏±‡∏Å -->
      <video id="side-video" src="career-video.mp4" preload="auto" crossorigin="anonymous" playsinline muted loop></video>
      <!-- ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏•‡∏±‡∏Å -->
      <audio id="voice" src="voice.mp3" preload="auto"></audio>
    </a-assets>

    <!-- Hiro Marker -->
    <a-marker id="hiro-marker" preset="hiro">
      
      <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏à‡∏≤‡∏Å marker -->
      <a-entity id="marker-container">
        <!-- ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏à‡∏≤‡∏Å marker (‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á ‡πÄ‡∏Å‡πà‡∏≤) -->
        <a-entity id="main-model-entity" 
                  gltf-model="#main-model" 
                  animation-mixer
                  scale="0.3 0.3 0.3" 
                  position="0 0 0" 
                  rotation="0 45 0">
        </a-entity>

        <!-- ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏≤‡∏Å marker (‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≤‡∏á ‡πÄ‡∏Å‡πà‡∏≤) -->
        <a-plane id="side-video-plane" 
                 material="src: #side-video; side: double; transparent: false; shader: flat" 
                 width="1.5" 
                 height="0.84" 
                 position="-2 0.5 0" 
                 rotation="0 15 0">
        </a-plane>
      </a-entity>

      <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏≠‡∏≤‡∏ä‡∏µ‡∏û (‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏î‡∏¢‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô) -->
      <a-entity id="career-container" visible="false">
        <!-- ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏≠‡∏≤‡∏ä‡∏µ‡∏û (‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤) -->
        <a-entity id="career-model" 
                  scale="0.3 0.3 0.3" 
                  position="-0.3 0.08 0.1" 
                  rotation="0 45 0"
                  visible="false">
        </a-entity>

        <!-- ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û (‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á) -->
        <a-plane id="career-video" 
                 width="1.5" 
                 height="0.84" 
                 position="0.4 0.5 -0.1" 
                 rotation="0 0 0"
                 visible="false">
        </a-plane>

        <!-- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
        <a-text id="career-status" 
                value="Career Loading..." 
                position="0 1.2 0" 
                align="center" 
                color="yellow" 
                visible="false">
        </a-text>
      </a-entity>

    </a-marker>

    <!-- ‡∏Å‡∏•‡πâ‡∏≠‡∏á -->
    <a-entity camera></a-entity>
    
  </a-scene>

  <script>
    console.log('üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô AR Application...');
    
    const arScene = document.querySelector('#arScene');
    const marker = document.querySelector('#hiro-marker');
    const markerContainer = document.querySelector('#marker-container');
    const careerContainer = document.querySelector('#career-container');
    
    const mainModel = document.querySelector('#main-model-entity');
    const sideVideo = document.querySelector('#side-video');
    const voice = document.querySelector('#voice');
    
    const careerModel = document.querySelector('#career-model');
    const careerVideo = document.querySelector('#career-video');
    const careerStatus = document.querySelector('#career-status');
    
    const unlockBtn = document.querySelector('#unlockBtn');
    const scanFrame = document.querySelector('#scanFrame');
    const status = document.querySelector('#status');
    const careerBtn = document.querySelector('#careerBtn');
    const menu = document.querySelector('#careerMenu');
    const closeBtn = document.querySelector('#closeMenu');
    
    let markerFound = false;

    // ‡∏£‡∏≠‡πÉ‡∏´‡πâ A-Frame ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
    arScene.addEventListener('loaded', () => {
      console.log('‚úÖ A-Frame ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à');
      
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î asset ‡πÅ‡∏ö‡∏ö‡πÑ‡∏î‡∏ô‡∏≤‡∏°‡∏¥‡∏Å (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô cache)
      const loadAssetDynamic = (id, src) => {
        return new Promise((resolve) => {
          // ‡∏•‡∏ö asset ‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
          const existingAssets = document.querySelectorAll(`[id^="${id}"]`);
          existingAssets.forEach(asset => {
            asset.remove();
            console.log('‡∏•‡∏ö asset ‡πÄ‡∏Å‡πà‡∏≤:', asset.id);
          });
          
          // ‡∏™‡∏£‡πâ‡∏≤‡∏á unique ID ‡∏î‡πâ‡∏ß‡∏¢ timestamp
          const timestamp = Date.now();
          const uniqueId = `${id}_${timestamp}`;
          
          const assets = document.querySelector('a-assets');
          
          if (src.endsWith('.mp4')) {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á video element ‡πÉ‡∏´‡∏°‡πà
            const videoEl = document.createElement('video');
            videoEl.id = uniqueId;
            videoEl.src = `${src}?t=${timestamp}`; // ‡πÄ‡∏û‡∏¥‡πà‡∏° timestamp ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô cache
            videoEl.setAttribute('preload', 'auto');
            videoEl.setAttribute('crossorigin', 'anonymous');
            videoEl.setAttribute('playsinline', '');
            videoEl.setAttribute('muted', '');
            videoEl.setAttribute('loop', '');
            
            console.log('‡∏™‡∏£‡πâ‡∏≤‡∏á video asset:', uniqueId, videoEl.src);
            assets.appendChild(videoEl);
            
            // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            const handleLoaded = () => {
              console.log('Video asset ‡∏û‡∏£‡πâ‡∏≠‡∏°:', uniqueId);
              resolve(`#${uniqueId}`);
            };
            
            if (videoEl.readyState >= 2) {
              handleLoaded();
            } else {
              videoEl.addEventListener('loadeddata', handleLoaded, { once: true });
              // Backup timeout
              setTimeout(() => {
                console.log('Video timeout - ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠:', uniqueId);
                resolve(`#${uniqueId}`);
              }, 3000);
            }
            
          } else {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á asset item ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏°‡πÄ‡∏î‡∏•
            const assetEl = document.createElement('a-asset-item');
            assetEl.id = uniqueId;
            assetEl.src = `${src}?t=${timestamp}`;
            
            console.log('‡∏™‡∏£‡πâ‡∏≤‡∏á model asset:', uniqueId, assetEl.src);
            assets.appendChild(assetEl);
            
            // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÇ‡∏´‡∏•‡∏î
            assetEl.addEventListener('loaded', () => {
              console.log('Model asset ‡∏û‡∏£‡πâ‡∏≠‡∏°:', uniqueId);
              resolve(`#${uniqueId}`);
            });
            
            // Backup timeout
            setTimeout(() => {
              console.log('Model timeout - ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠:', uniqueId);
              resolve(`#${uniqueId}`);
            }, 3000);
          }
        });
      };

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏≠‡πÉ‡∏´‡πâ Entity ‡∏û‡∏£‡πâ‡∏≠‡∏°
      const waitForEntity = (entity) => {
        return new Promise((resolve) => {
          if (entity.hasLoaded) {
            resolve();
          } else {
            entity.addEventListener('loaded', resolve, { once: true });
            setTimeout(resolve, 1000); // backup timeout
          }
        });
      };

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û
      const changeCareer = (careerName) => {
        console.log('üîÑ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡πÄ‡∏õ‡πá‡∏ô:', careerName);
        
        // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô
        markerContainer.setAttribute('visible', 'false');
        careerContainer.setAttribute('visible', 'false');
        careerModel.setAttribute('visible', 'false');
        careerVideo.setAttribute('visible', 'false');
        careerStatus.setAttribute('visible', 'false');
        
        // ‡∏´‡∏¢‡∏∏‡∏î‡∏™‡∏∑‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        sideVideo.pause();
        voice.pause();
        
        setTimeout(() => {
          // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
          if (careerName !== 'Test Model') {
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Test Model ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á
            console.log('‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö:', careerName);
            status.textContent = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ${careerName} (‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô)`;
            status.style.background = 'rgba(255,100,0,0.7)';
            scanFrame.style.display = 'none';
            return;
          }
          
          // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Test Model ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á marker content
          markerContainer.setAttribute('visible', 'true');
          careerContainer.setAttribute('visible', 'false');
          
          status.textContent = '‡πÅ‡∏™‡∏î‡∏á: ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô';
          status.style.background = 'rgba(0,255,0,0.7)';
          scanFrame.style.display = 'none';
          
          // ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å
          sideVideo.currentTime = 0;
          sideVideo.play().catch(e => console.warn('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÑ‡∏î‡πâ:', e));
          
          setTimeout(() => {
            voice.currentTime = 0;
            voice.play().catch(e => console.warn('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ:', e));
          }, 1000);
          
        }, 300);
      };

      // ‡πÄ‡∏õ‡∏¥‡∏î AR ‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å
      const startAR = () => {
        voice.play().then(() => voice.pause()); 
        sideVideo.play().then(() => sideVideo.pause());
        unlockBtn.style.display = 'none'; 
        scanFrame.style.display = 'block'; 
        status.style.display = 'block'; 
        arScene.style.visibility = 'visible';
        careerBtn.style.display = 'block';
        document.body.removeEventListener('click', startAR);
      };
      document.body.addEventListener('click', startAR);

      // ‡∏û‡∏ö marker
      marker.addEventListener('markerFound', () => {
        status.textContent = '‡∏û‡∏ö Hiro Marker!';
        status.style.background = 'rgba(0,255,0,0.7)';
        scanFrame.style.display = 'none';
        markerFound = true;
        
        // ‡∏ã‡πà‡∏≠‡∏ô career container ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á marker container
        careerContainer.setAttribute('visible', 'false');
        markerContainer.setAttribute('visible', 'true');
        
        // ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å marker
        sideVideo.currentTime = 0; 
        sideVideo.play().catch(e=>console.warn(e)); 
        setTimeout(()=>{ 
          voice.currentTime=0; 
          voice.play().catch(e=>console.warn(e)); 
        },1000);
      });

      // ‡∏´‡∏≤‡∏¢ marker - ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ï‡∏•‡∏≠‡∏î (sticky display)
      marker.addEventListener('markerLost', () => {
        // ‡πÑ‡∏°‡πà‡∏ã‡πà‡∏≠‡∏ô marker container ‡πÅ‡∏°‡πâ marker ‡∏´‡∏≤‡∏¢‡πÑ‡∏õ
        // markerContainer ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà
        
        if (!markerFound) {
          status.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Hiro Marker...';
          status.style.background = 'rgba(0,0,0,0.7)';
          scanFrame.style.display = 'block';
        } else {
          status.textContent = '‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πÅ‡∏Å‡∏ô marker)';
          status.style.background = 'rgba(0,150,255,0.7)';
          scanFrame.style.display = 'none';
          // ‡πÉ‡∏´‡πâ marker container ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà
          markerContainer.setAttribute('visible', 'true');
        }
      });

      // ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏Ñ‡∏•‡∏¥‡∏Å
      careerBtn.addEventListener('click', () => {
        menu.style.display = 'block';
      });
      
      // ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π
      closeBtn.addEventListener('click', () => {
        menu.style.display = 'none';
      });
      
      // ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏¢‡∏á‡∏≤‡∏ô - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏• ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      menu.querySelectorAll('button[data-career]').forEach(btn => {
        btn.addEventListener('click', () => {
          const careerName = btn.getAttribute('data-career');
          changeCareer(careerName);
          menu.style.display = 'none';
        });
      });
    });
  </script>
</body>
</html>
